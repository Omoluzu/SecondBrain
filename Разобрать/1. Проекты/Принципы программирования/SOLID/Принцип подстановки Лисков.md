**Принцип подстановки Лисков** (LSP) является третьим из пяти принципов SOLID, сформулированных [Барбарой Лисков](Барбара%20Лисков) в 1987 году. Он играет ключевую роль в проектировании иерархий классов в объектно-ориентированном программировании и обеспечивает правильное использование наследования.

## Определение LSP

Принцип подстановки Лисков гласит, что **объекты подкласса должны быть взаимозаменяемыми с объектами базового класса без изменения желаемых свойств программы**. Это означает, что если класс S является подклассом класса T, то объекты типа S должны вести себя так же, как объекты типа T, не нарушая логики работы программы. Формально, это можно выразить следующим образом: если для каждого объекта o1o1​ типа SS существует объект o2o2​ типа TT, такой что для любой программы PP, определенной в терминах TT, поведение PP не изменяется при замене o2o2​ на o1o1​, то SS является подтипом TT [1](https://metanit.com/sharp/patterns/5.3.php) [2](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B8%D0%BD%D1%86%D0%B8%D0%BF_%D0%BF%D0%BE%D0%B4%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8_%D0%9B%D0%B8%D1%81%D0%BA%D0%BE%D0%B2).

## Основные аспекты LSP

1. **Взаимозаменяемость**: Подклассы должны расширять функциональность базовых классов, не изменяя их поведение. Это позволяет использовать полиморфизм без дополнительных проверок типов.
2. **Сохранение инвариантов**: Подклассы должны сохранять инварианты базового класса. Это означает, что все свойства и условия, которые действуют для базового класса, должны оставаться верными и для подклассов.
3. **Избежание исключений**: Методы подкласса не должны генерировать исключения, которые не предусмотрены в базовом классе. Это помогает избежать неожиданных ошибок при использовании подклассов.

## Пример нарушения LSP

Рассмотрим пример с классами `Rectangle` и `Square`. В этом случае `Square` является подклассом `Rectangle`, но он нарушает принцип подстановки Лисков:

```python
class Rectangle:     
	def __init__(self, width, height):        
		self.width = width        
		self.height = height     
		
	def set_width(self, width):        
		self.width = width     
		
	def set_height(self, height):        
		self.height = height     
		
	def area(self):        
		return self.width * self.height 
		
class Square(Rectangle):     
	def __init__(self, size):        
		super().__init__(size, size)     
	
	def set_width(self, width):        
		self.width = width        
		self.height = width  # Изменение поведения     
		
	def set_height(self, height):        
		self.height = height        
		self.width = height  # Изменение поведения
```

В этом примере класс `Square` изменяет поведение методов `set_width` и `set_height`, что приводит к несоответствию ожиданиям пользователей класса `Rectangle`. Если мы заменим объект `Rectangle` на объект `Square`, это может привести к неправильным вычислениям площади.

## Правильная реализация LSP

Чтобы соблюсти принцип подстановки Лисков в этом примере, можно выделить общий интерфейс или абстрактный класс:

```python
class Shape:     
	def area(self):        
		raise NotImplementedError 
		
class Rectangle(Shape):     
	def __init__(self, width, height):        
		self.width = width        
		self.height = height     
		
	def area(self):        
		return self.width * self.height 

class Square(Shape):     
	def __init__(self, size):        
		self.size = size     
		
	def area(self):        
		return self.size * self.size`
```

Теперь оба класса `Rectangle` и `Square` реализуют метод `area`, но каждый из них сохраняет свое поведение и не нарушает ожидания пользователей.

## Заключение

Принцип подстановки Лисков помогает разработчикам создавать более предсказуемые и надежные системы. Соблюдение этого принципа способствует правильной организации иерархий классов и позволяет использовать полиморфизм без дополнительных проверок типов. Это также облегчает тестирование и поддержку кода, так как изменения в подклассах не влияют на базовый класс и другие его экземпляры [3](https://habr.com/ru/articles/83269/) [4](https://solidbook.vercel.app/lsp) [5](https://alexkosarev.name/2023/03/02/solid-in-details-lsp/).