---
tags:
  - "#system_call"
---



**dup(2)** - [[Linux. Системные вызовы|Системный вызов]] в системе Linux используется для создания копии существующего [[Дескриптор файлов|Файлового дескриптора]]. 

Этот вызов принимает один аргумент `oldfd`, который представляет файловый дескриптор, который необходимо скопировать. `dup(2)` возвращает новый файловый дескриптор, который является копией `oldfd`, используя для этого самый маленький свободный номер дескриптора в текущем процессе.

**Основные особенности:**
- **Взаимозаменяемость дескрипторов**: Старый и новый дескриптор могут использоваться друг вместо друга, так как они указывают на одно и то же открытое файловое описание.
- **Общие атрибуты**: Оба дескриптора имеют общее файловое смещение и флаги состояния файла. Например, изменение смещения с помощью [[lseek(2)]] через один дескриптор изменит его и для другого.
- **Различные флаги дескриптора**: Флаг `close-on-exec` (`FD_CLOEXEC`) у копии дескриптора сбрасывается по умолчанию.

**Пример использования**
```c
#include <unistd.h>
#include <stdio.h>

int main() {
    int fd = open("example.txt", O_RDONLY);
    if (fd == -1) {
        perror("open");
        return 1;
    }

    int new_fd = dup(fd);
    if (new_fd == -1) {
        perror("dup");
        return 1;
    }

    // Теперь new_fd и fd взаимозаменяемы
    close(fd);
    close(new_fd);

    return 0;
}
```

Этот вызов часто используется в операциях с конвейерами для перенаправления потоков ввода/вывода между процессами.